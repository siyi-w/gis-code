---
title: "prac4"
author: "siyi"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:


```{r}
library(sf)
library(tidyverse)
library(here)
library(janitor)
library(countrycode)
library(readr)
```
```{r}
world <- st_read("prac4-data/World_Countries.geojson")
HDI <- read_csv(here::here("prac4-data/hdr-data-11.csv"),
                na="",skip=0)
```
```{r}
HDIcols<- HDI %>%
  clean_names() %>%
 # 只保留真正的国家名称（过滤掉 Arab States, World 等）
  filter(country %in% countrycode::codelist$country.name.en) %>%
  
  # 只保留 GII 指标
  filter(indicator_code == "gii") %>%
  
  # 只保留 2019 和 2020（如果数据里没有 2020，这一步会自动只保留 2019）
  filter(year %in% c(2019, 2020)) %>% 
  
  select(country_iso_code, country, year, value) %>%
  
  # 宽格式：每国家一行
  pivot_wider(
    names_from = year,
    values_from = value,
    names_prefix = "gii_"
  ) %>%
  
  # 生成 ISO2（for maps）
  mutate(
    iso2 = countrycode(country_iso_code, "iso3c", "iso2c")
  )
```

```{r}
Join_HDI<- world %>%
  clean_names() %>%
  left_join(.,
            HDIcols,
            by = c("iso"="iso2"))
```




